{
  "AWSEBDockerrunVersion": "2",
  "volumes": [
    {
      "name": "settings",
      "host": {
        "sourcePath": "/var/app/current/src/clubbable/clubbable/settings"
      }
    },
    {
      "name": "nginx_conf_d",
      "host": {
        "sourcePath": "/var/app/current/docker/nginx/conf.d"
      }
    },
    {
      "name": "static_root",
      "host": {
        "sourcePath": "/var/app/current/src/clubbable/clubbable/static"
      }
    },
    {
      "name": "nginx_secrets",
      "host": {
        "sourcePath": "/var/app/current/docker/nginx/secrets"
      }
    }
  ],
  "containerDefinitions": [
    {
      "name": "rabbit",
      "image": "rabbitmq",
      "essential": true,
      "memoryReservation": 256
    },
    {
      "name": "app",
      "image": "kaapstorm/clubbable:latest",
      "essential": true,
      "memoryReservation": 384,
      "links": ["rabbit"],
      "mountPoints": [
        {
          "sourceVolume": "settings",
          "containerPath": "/usr/src/clubbable/src/clubbable/clubbable/settings",
          "readOnly": true
        }
      ]
    },
    {
      "name": "nginx_certbot",
      "image": "kaapstorm/nginx-certbot:latest",
      "essential": true,
      "environment" : [
        { "name" : "CERTBOT_EMAIL", "value" : "{{ CERTBOT_EMAIL }}" }
      ],
      "memoryReservation": 256,
      "portMappings": [
        {
          "hostPort": 80,
          "containerPort": 80
        },
        {
          "hostPort": 443,
          "containerPort": 443
        }
      ],
      "links": ["app"],
      "mountPoints": [
        {
          "sourceVolume": "nginx_conf_d",
          "containerPath": "/etc/nginx/conf.d"
        },
        {
          "sourceVolume": "static_root",
          "containerPath": "/usr/share/nginx/html",
          "readOnly": true
        },
        {
          "sourceVolume": "nginx_secrets",
          "containerPath": "/etc/letsencrypt"
        }
      ]
    }
  ]
}
